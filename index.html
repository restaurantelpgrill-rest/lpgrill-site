<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LP Grill ‚Äî Card√°pio</title>

  <link rel="stylesheet" href="css/style.css" />

  <!-- Admin Gear discreta (s√≥ pro index) -->
  <style>
    .admin-gear{
      position: fixed;
      top: 8px;
      left: 8px;
      width: 22px;
      height: 22px;
      display: grid;
      place-items: center;
      text-decoration: none;
      border-radius: 999px;
      z-index: 9999;
      user-select: none;
      font-size: 13px;
      line-height: 1;
      opacity: .12;
      background: transparent;
      color: rgba(0,0,0,.65);
      transition: opacity .2s ease, transform .2s ease, background .2s ease;
    }
    .admin-gear:hover{
      opacity: .95;
      transform: rotate(80deg) scale(1.06);
      background: rgba(0,0,0,.06);
    }
    .admin-gear:active{ transform: rotate(120deg) scale(.98); }
    @media (max-width: 520px){
      .admin-gear{ opacity:.08; top:6px; left:6px; }
      .admin-gear:hover{ opacity:.55; }
    }
  </style>
</head>

<body class="app">

  <a href="#" id="adminGear" class="admin-gear" aria-label="Admin" title="Admin">‚öô</a>

  <!-- TOPBAR -->
  <header class="pagebar">
    <div class="brand-mini">
      <img src="img/logo.png" alt="LP Grill">
    </div>

    <div class="page-title">
      <h1>Card√°pio</h1>
      <p>Escolha uma categoria para come√ßar</p>
    </div>

    <!-- ‚úÖ padr√£o √∫nico: data-open-cart -->
    <button class="cart-btn" id="openCart" data-open-cart type="button" aria-label="Carrinho">
      <span class="cart-ico">üõí</span>
      <span class="cart-badge" id="cartBadge" hidden>0</span>
    </button>
  </header>

  <div class="container subinfo" id="infoBar"></div>

  <main class="container">

    <div class="grid">

      <a class="tile" href="marmitas.html">
        <div class="tile-media"><img src="img/cat-marmitas.jpg" alt="Marmitas"></div>
        <div>
          <div class="tile-title">Marmitas</div>
          <div class="tile-sub">Pratos do dia ‚Ä¢ bem servidos</div>
        </div>
      </a>

      <a class="tile" href="porcoes.html">
        <div class="tile-media"><img src="img/cat-porcoes.jpg" alt="Por√ß√µes"></div>
        <div>
          <div class="tile-title">Por√ß√µes</div>
          <div class="tile-sub">Perfeito pra compartilhar</div>
        </div>
      </a>

      <a class="tile" href="bebidas.html">
        <div class="tile-media"><img src="img/cat-bebidas.jpg" alt="Bebidas"></div>
        <div>
          <div class="tile-title">Bebidas</div>
          <div class="tile-sub">Geladas ‚Ä¢ do jeito certo</div>
        </div>
      </a>

      <a class="tile" href="sobremesas.html">
        <div class="tile-media"><img src="img/cat-sobremesas.jpg" alt="Sobremesas"></div>
        <div>
          <div class="tile-title">Sobremesas</div>
          <div class="tile-sub">Finalize com chave de ouro</div>
        </div>
      </a>

      <a class="tile highlight" href="combo.html" data-open-combo>
  <div class="tile-media"><img src="img/cat-finalizar.jpg" alt="Combo"></div>
  <div>
    <div class="tile-title">Combo</div>
    <div class="tile-sub">Monte e economize</div>
  </div>
</a>
    </div>

    <a class="wa-float" id="waFloat" href="#" aria-label="WhatsApp">
      <img src="img/whatsapp.png" alt="WhatsApp">
    </a>
  </main>

  <!-- ‚úÖ Barra inferior -->
  <div class="sticky-cta" id="stickyCTA" hidden>
    <button class="cta" id="ctaOpenCart" data-open-cart type="button">
      <span>
        <strong style="display:block; font-weight:1000;">Ver carrinho</strong>
        <span class="mini" style="display:block;">Itens e total</span>
      </span>
      <strong id="ctaTotal">R$ 0,00</strong>
    </button>

    <!-- ‚úÖ Finalizar aqui tamb√©m abre overlay (sem navega√ß√£o) -->
    <a class="cta primary" href="checkout.html" data-open-checkout>Finalizar</a>
  </div>

  <!-- =========================
       CARRINHO (VISUAL NOVO)
       mant√©m IDs do seu JS
       ========================= -->

  <!-- overlay/backdrop -->
  <div class="cart-overlay drawer-backdrop" id="closeCartBackdrop"></div>

  <!-- drawer -->
  <aside class="drawer cart-drawer" id="cartDrawer" aria-hidden="true">

    <div class="drawer-panel" role="dialog" aria-modal="true" aria-label="Carrinho">

      <!-- header premium -->
      <div class="drawer-head cart-header">
        <div class="cart-titlebox">
          <h3 class="cart-title">Seu carrinho</h3>
          <p class="cart-subtitle">Itens + taxa (se entrega)</p>
        </div>
        <button class="icon-btn cart-close" id="closeCart" aria-label="Fechar" type="button">‚úï</button>
      </div>

      <!-- body premium -->
      <div class="drawer-body cart-body">
        <div class="delivery-toggle cart-mode">
          <button class="dt-btn is-active" id="modeEntrega" type="button">üöö Entrega</button>
          <button class="dt-btn" id="modeRetirar" type="button">üè¨ Retirar</button>
        </div>

        <!-- seu render.js/cart.js j√° preenche aqui -->
        <div id="cartItems" class="cart-list"></div>
      </div>

      <!-- footer premium -->
      <div class="drawer-foot cart-footer">
        <div class="totals cart-summary">
          <div class="row cart-row"><span>Subtotal</span><strong id="subTotal">R$ 0,00</strong></div>
          <div class="row cart-row"><span>Taxa</span><strong id="deliveryFee">R$ 0,00</strong></div>
          <div class="row total cart-row"><span>Total</span><strong class="cart-total" id="grandTotal">R$ 0,00</strong></div>
          <div class="mini muted cart-eta">‚è±Ô∏è Tempo m√©dio: <span id="etaText">30‚Äì60 min</span></div>
        </div>

        <div class="drawer-actions cart-footer-actions">
          <button class="btn light btn-cart danger" id="clearCart" type="button">Limpar</button>
          <!-- ‚úÖ Finalizar no drawer tamb√©m abre overlay -->
          <a class="btn primary btn-cart primary" href="checkout.html" data-open-checkout>Finalizar</a>
        </div>
      </div>

    </div>
  </aside>

  <div class="toast" id="toast"></div>

  <!-- CHECKOUT OVERLAY -->
  <div id="checkoutOverlay" class="ck-overlay" aria-hidden="true">
    <div class="ck-modal" role="dialog" aria-modal="true" aria-label="Finalizar pedido">
      <header class="ck-head">
        <div class="ck-title">
          <strong>Finalizar pedido</strong>
          <span class="ck-sub">Escolha pagamento e confirme seus dados</span>
        </div>
        <button id="ckClose" class="ck-x" type="button" aria-label="Fechar">‚úï</button>
      </header>

      <!-- STEP: PAGAMENTO -->
      <section class="ck-step" data-step="pay">
        <div class="ck-card">
          <p class="ck-hint">Como voc√™ quer pagar?</p>

          <div class="ck-grid">
            <button class="ck-pay" type="button" data-pay="pix">
              <span class="ck-pay-title">PIX</span>
              <span class="ck-pay-desc">Copia e cola + QR Code</span>
            </button>

            <button class="ck-pay" type="button" data-pay="credit">
              <span class="ck-pay-title">Cart√£o (Cr√©dito)</span>
              <span class="ck-pay-desc">Pagar na entrega/retirada</span>
            </button>

            <button class="ck-pay" type="button" data-pay="debit">
              <span class="ck-pay-title">Cart√£o (D√©bito)</span>
              <span class="ck-pay-desc">Pagar na entrega/retirada</span>
            </button>
          </div>
        </div>

        <div class="ck-actions">
          <button id="ckCancel" class="ck-btn ghost" type="button" style="width:100%;">Cancelar</button>
        </div>
      </section>

      <!-- STEP: ENDERE√áO -->
      <section class="ck-step" data-step="addr" hidden>
        <div class="ck-card">
          <p class="ck-hint" id="ckKmHint">Toque em ‚ÄúUsar minha localiza√ß√£o (GPS)‚Äù para calcular a taxa.</p>

          <div id="ckFeeLine" class="ck-fee" hidden>
            <div><span>Dist√¢ncia</span> <strong id="ckKm">‚Äî</strong></div>
            <div><span>Taxa</span> <strong id="ckFee">‚Äî</strong></div>
          </div>

          <div id="ckBlocked" class="ck-blocked" hidden>
            Fora do raio de entrega. Entrega indispon√≠vel.
          </div>

          <button id="ckGetLocation" class="ck-btn full" type="button">Usar minha localiza√ß√£o (GPS)</button>

          <div class="ck-form">
            <label class="ck-field">
              <span>Nome</span>
              <input id="ckName" type="text" placeholder="Seu nome" autocomplete="name" />
            </label>

            <label class="ck-field">
              <span>Telefone (DDD)</span>
              <input id="ckPhone" type="tel" placeholder="31999999999" autocomplete="tel" />
            </label>

            <label class="ck-field">
              <span>Bairro</span>
              <input id="ckBairro" type="text" placeholder="Ex.: Santa Tereza" />
            </label>

            <label class="ck-field">
              <span>Endere√ßo</span>
              <input id="ckAddress" type="text" placeholder="Rua, n√∫mero, refer√™ncia" autocomplete="street-address" />
            </label>

            <label class="ck-field">
              <span>Complemento (opcional)</span>
              <input id="ckCompl" type="text" placeholder="Apto, bloco, casa..." />
            </label>

            <label class="ck-field">
              <span>Observa√ß√µes (opcional)</span>
              <textarea id="ckObs" rows="3" placeholder="Sem cebola, ponto da carne, etc."></textarea>
            </label>
          </div>
        </div>

        <div class="ck-actions">
          <button id="ckBackFromAddr" class="ck-btn ghost" type="button" style="flex:1;">Voltar</button>
          <button id="ckConfirmOrder" class="ck-btn primary" type="button" style="flex:1.2;">Confirmar</button>
        </div>
      </section>

      <!-- STEP: PIX -->
      <section class="ck-step" data-step="pix" hidden>
        <div class="ck-card">
          <div class="ck-summary" style="display:grid; gap:6px; margin-bottom:10px;">
            <div class="row"><span>Subtotal</span> <strong id="ckTotalPix">R$ 0,00</strong></div>
            <div class="row"><span>Taxa</span> <strong id="ckFeePix">R$ 0,00</strong></div>
            <div class="row total"><span>Total</span> <strong id="ckPixTotal">R$ 0,00</strong></div>
          </div>

          <div class="ck-qrwrap">
            <div id="ckQr" class="ck-qr">Gerando QR‚Ä¶</div>
          </div>

          <label class="ck-field">
            <span>C√≥digo PIX (copia e cola)</span>
            <textarea id="ckPixCode" rows="4" readonly></textarea>
          </label>

          <button id="ckCopyPix" class="ck-btn full" type="button">Copiar c√≥digo PIX</button>

          <div class="ck-note muted" style="margin-top:10px; font-size:12px;">
            Depois de pagar, toque em ‚ÄúJ√° paguei‚Äù e envie o comprovante no WhatsApp.
          </div>

          <button id="ckPaidPix" class="ck-btn full ghost" type="button">J√° paguei (enviar comprovante)</button>
        </div>

        <div class="ck-actions">
          <button id="ckBackFromPix" class="ck-btn ghost" type="button" style="width:100%;">Voltar</button>
        </div>
      </section>
    </div>
  </div>
  <!-- /CHECKOUT OVERLAY -->

  <!-- Admin gear -->
  <script>
    (() => {
      const gear = document.getElementById("adminGear");
      if(!gear) return;

      gear.addEventListener("click", (e) => {
        e.preventDefault();
        const ok = localStorage.getItem("LPGRILL_ADMIN_SECRET_OK_V1") === "1";
        if(ok){ window.location.href = "admin.html"; return; }
        window.location.href = "admin.html?k=22550126";
      });
    })();
  </script>

  <!-- Scripts (ORDEM CERTA) -->
  <script src="js/data.js"></script>
  <script src="js/render.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/app.js"></script>

  <!-- QRCode + checkout.js -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="js/checkout.js"></script>

  <!-- ‚úÖ Padroniza√ß√£o final: abrir carrinho e badge sem setInterval -->
  <script>
    (() => {
      const badge = document.getElementById("cartBadge");

      function syncBadge(){
        try{
          const cart = window.Cart;
          if(!cart) return;
          let c = 0;
          if(typeof cart.count === "function") c = cart.count() || 0;
          else{
            const items = (typeof cart.items === "function" ? cart.items() : cart.items) || cart.state?.items;
            if(Array.isArray(items)) c = items.length;
          }
          if(badge){
            badge.hidden = c <= 0;
            badge.textContent = String(c);
          }
        }catch{}
      }

      function openCart(){
        const cta = document.getElementById("ctaOpenCart");
        cta?.click?.();
      }

      document.querySelectorAll("[data-open-cart]").forEach(el=>{
        el.addEventListener("click", (e)=>{
          e.preventDefault();
          openCart();
        });
      });

      document.addEventListener("lp:cart-change", syncBadge);
      syncBadge();
    })();
  </script>

</body>
</html>
